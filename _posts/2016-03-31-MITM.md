---
layout: post
title: MITM攻击
date: 2016-04-10
categories: blog
tags: [安全]
description: 中间人攻击的攻与防

---


## 中间人攻击
### 什么是中间人攻击？
中间人攻击（Man-in-the-Middle Attack, MITM）是一种由来已久的网络入侵手段，并且在今天仍然有着广泛的发展空间，曾经猖獗一时的SMB会话劫持、DNS欺骗等技术都是典型的MITM攻击手段。简而言之，所谓的MITM攻击就是通过拦截正常的网络通信数据，并进行数据篡改和嗅探，而通信的双方却毫不知情。

### 如何防范中间人攻击？

* 通过采用动态ARP检测、DHCP Snooping等控制操作来加强网络基础设施

* 采用传输加密：SSL和TLS可以阻止攻击者使用和分析网络流量。像Google等公司如今都有高级的网站搜索引擎优化，默认状态下都提供HTTPS。

* 使用CASBs(云访问安全代理)：CASBs可以提供加密、访问控制、异常保护以及数据丢失保护等一系列功能。
* 创建RASP(实时应用程序自我保护)：这是一个新概念，内置于应用程序中，用来防止实时攻击。

* 阻止自签名证书：自签名证书很容易伪造。但是目前还没有撤销它们的机制。所以，应该使用有效证书颁发机构提供的证书。

* 强制使用SSL pinning：这是对抗MiTM攻击的另一种方式。使用有效证书颁发机构提供的证书是第一步，它是通过返回的受信任的根证书以及是否与主机名匹配来验证该服务器提供的证书的有效性。通过SSL pinning可以验证客户端检查服务器证书的有效性。

* 安装DAM(数据库活动监控)：DAM可以监控数据库活动，检测篡改数据。

**MiTM攻击是一个很大的挑战，它是利用用户和用户连接的服务器之间的信任。这种攻击的危险之处在于，用户想当然的认为他们的连接很安全。只有我们开始意识到这种攻击的危险真正存在，并且花很多时间去进行适当的控制时，比如加密、适当的验证、强大的应用程序验证以及通过系统来检测篡改等，才可以防御MiTM攻击。**
##补充：
### 会话劫持（SessionHijack）

例如你Telnet到某台主机，这就是一次Telnet会话；你浏览某个网站，这就是一次HTTP会话。而会话劫持（Session Hijack），就是结合了嗅探以及欺骗技术在内的攻击手段。例如，在一次正常的会话过程当中，攻击者作为第三方参与到其中，他可以在正常数据包中插入恶意数据，也可以在双方的会话当中进行监听，甚至可以是代替某一方主机接管会话。

我们可以把会话劫持攻击分为两种类型：

1）中间人攻击(Man In The Middle，简称MITM)，

2）注射式攻击（Injection）；

并且，还可以把会话劫持攻击分为两种形式：

1）被动劫持，

2）主动劫持；

被动劫持实际上就是在后台监视双方会话的数据流，从中获得敏感数据；而主动劫持则是将会话当中的某一台主机“踢”下线，然后由攻击者取代并接管会话，这种攻击方法危害非常大。

这只是一种大概的描述，具体实施会话劫持还有很多的技术细节。

### DNS欺骗

DNS欺骗（DNSSpoofing），就是其中的一种惯用手法。

攻击者通过入侵DNS服务器、控制路由器等方法把受害者要访问的目标机器域名对应的IP解析为攻击者所控制的机器，这样受害者原本要发送给目标机器的数据就发到了攻击者的机器上，这时攻击者就可以监听甚至修改数据，从而收集到大量的信息。

如果攻击者只是想监听双方会话的数据，他会转发所有的数据到真正的目标机器上，让目标机器进行处理，再把处理结果发回到原来的受害者机器；

如果攻击者要进行彻底的破坏，他会伪装目标机器返回数据，这样受害者接收处理的就不再是原来期望的数据，而是攻击者所期望的了。例如让DNS服务器解析银行网站的IP为自己机器IP，同时在自己机器上伪造银行登录页面，那么受害者的真实账号和密码就暴露给入侵者了。这便是传说中的**网络钓鱼**。
