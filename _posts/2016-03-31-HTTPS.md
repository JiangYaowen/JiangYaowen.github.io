---
layout: post
title: HTTPS通信
date: 2016-03-18
categories: blog
tags: [网络通信]
description: HTTPS的通信过程

---

## HTTPS通信
HTTPS能够加密信息，以免敏感信息被第三方获取，所以很多银行网站或电子邮箱等等安全级别较高的服务都会采用HTTPS协议。

### 简介
HTTPS其实是由两部分组成：HTTP + SSL / TLS，也就是在HTTP上又加了一层处理加密信息的模块。服务端和客户端的信息传输都会通过TLS进行加密，所以传输的数据都是加密后的数据。

### 通信过程
1、客户端发起HTTPS请求

用户在浏览器里输入一个https网址，

2、服务端的配置

采用HTTPS协议的服务器必须要有一套数字证书，可以自己制作，也可以向组织申请。区别就是自己颁发的证书需要客户端验证通过，才可以继续访问，而使用受信任的公司申请的证书则不会弹出提示页面（即CA，见后面）。这套证书其实就是一对公钥和私钥。

3、传送证书

服务器将这个证书（其实就是公钥，只是包含了很多信息，如证书的颁发机构，过期时间等等）传给客户浏览器。

4、客户端解析证书

这部分工作是有客户端的TLS来完成的，首先会验证公钥是否有效，比如颁发机构（是否由自己信赖的 CA 中心所签发的），过期时间等等，如果发现异常，则会弹出一个警告框，提示证书存在问题。如果证书没有问题，那么就生成一个随即值。然后用证书对该随机值进行加密。

5、传送加密信息

这部分传送的是用证书加密后的随机值，目的就是让服务端得到这个随机值，以后客户端和服务端的通信就可以通过这个随机值来进行加密解密了。

6、服务端解密信息

服务端用私钥解密后，得到了客户端传过来的随机值(私钥)，然后把内容通过该值进行对称加密。所谓对称加密就是，将信息和私钥通过某种算法混合在一起，这样除非知道私钥，不然无法获取内容，而正好客户端和服务端都知道这个私钥，所以只要加密算法够彪悍，私钥够复杂，数据就够安全。

7、传输加密后的信息

这部分信息是服务段用私钥加密后的信息，可以在客户端被还原

8、客户端解密信息

客户端用之前生成的私钥解密服务段传过来的信息，于是获取了解密后的内容。整个过程第三方即使监听到了数据，也束手无策。

**整个https流程实际上是：** 使用非对称加密算法保证对称加密密钥的安全传递，然后使用对称加密来保证数据传输过程中的安全性 

### 补充
**CA证书**
 
CA证书是由权威机构颁发（意味着你可以信任他），证书的内容包含多种信息，其中就包括服务器的公钥，还包括证书有效期等等。 
通过它建立我们的信任基点，就可以保证服务器公钥被正确的传递给浏览器，然后浏览器可以使用它安全的把对称加密的密钥传递给服务器，之后以此密钥加密需要传递的信息，保证了数据的安全性。 
